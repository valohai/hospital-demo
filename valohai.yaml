- step:
    name: split
    image: valohai/hospital-demo
    command: python3 ./split.py {parameters}
    parameters:
    - name: testsize
      default: 0.1
      multiple-separator: ','
      optional: false
      type: float
    inputs:
    - name: data
      optional: false
      default:
        - https://valohai-hospital-demo.s3-eu-west-1.amazonaws.com/training_v2.csv
- step:
    name: preprocess
    image: valohai/hospital-demo
    command: python3 ./preprocess.py {parameters}
    inputs:
    - name: data
      optional: false
    - name: dictionary
      optional: false
      default:
        - https://valohai-hospital-demo.s3-eu-west-1.amazonaws.com/dictionary.csv
- step:
    name: train
    image: valohai/hospital-demo
    command: python3 ./train.py {parameters}
    parameters:
    - name: learning_rate
      default: 0.001
      multiple-separator: ','
      optional: false
      type: float
    - name: iterations
      default: 10000
      multiple-separator: ','
      optional: false
      type: integer
    - name: early_stopping_rounds
      default: 200
      multiple-separator: ','
      optional: false
      type: integer
    - name: depth
      default: 6
      multiple-separator: ','
      optional: false
      type: integer
    - name: l2_leaf_reg
      default: 3.0
      multiple-separator: ','
      optional: false
      type: float
    - name: random_seed
      default: 123
      multiple-separator: ','
      optional: false
      type: integer
    inputs:
    - name: data
      optional: false
    - name: labels
      optional: false
- step:
    name: predict
    image: valohai/hospital-demo
    command: python3 ./predict.py {parameters}
    inputs:
    - name: data
      optional: false
    - name: model
      optional: false
      default:
        - https://valohai-hospital-demo.s3-eu-west-1.amazonaws.com/model.cbm
- pipeline:
    name: re-train
    nodes:
      - name: split
        type: execution
        step: split
      - name: preprocess_train
        type: execution
        step: preprocess
      - name: preprocess_test
        type: execution
        step: preprocess
      - name: train
        type: execution
        step: train
      - name: predict_test
        type: execution
        step: predict
      - name: predict_train
        type: execution
        step: predict
    edges:
      - [split.output.train/data*, preprocess_train.input.data]
      - [split.output.train/labels*, train.input.labels]
      - [split.output.test/data*, preprocess_test.input.data]
      - [preprocess_train.output.data*, train.input.data]
      - [preprocess_test.output.data*, predict_train.input.data]
      - [preprocess_test.output.data*, predict_test.input.data]
      - [train.output.model*, predict_train.input.model]
